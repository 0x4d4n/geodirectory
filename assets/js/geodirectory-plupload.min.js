jQuery.fn.exists=function(){return jQuery(this).length>0};jQuery(document).ready(function($){if($(".plupload-upload-uic").exists()){var pconfig=false;var msgErr="";var post_id="";if(jQuery("#geodirectory-add-post input[name='ID']").length){var post_id=jQuery("#geodirectory-add-post input[name='ID']").val()}else{post_id=jQuery("#post input[name='post_ID']").val()}$(".plupload-upload-uic").each(function(){var $this=$(this);var id1=$this.attr("id");var imgId=id1.replace("plupload-upload-ui","");plu_show_thumbs(imgId);pconfig=JSON.parse(geodir_plupload_params.base_plupload_config);pconfig["browse_button"]=imgId+pconfig["browse_button"];pconfig["container"]=imgId+pconfig["container"];if(jQuery("#"+imgId+"dropbox").length){pconfig["drop_element"]=imgId+"dropbox"}pconfig["file_data_name"]=imgId+pconfig["file_data_name"];pconfig["multipart_params"]["imgid"]=imgId;pconfig["multipart_params"]["post_id"]=post_id;if($this.hasClass("plupload-upload-uic-multiple")){pconfig["multi_selection"]=true}var allowed_exts=jQuery("#"+imgId+"_allowed_types").val();allowed_exts=allowed_exts&&allowed_exts!=""?allowed_exts:"";if(imgId=="post_images"&&typeof geodir_params.gd_allowed_img_types!="undefined"&&geodir_params.gd_allowed_img_types!=""){allowed_exts=geodir_params.gd_allowed_img_types}if(allowed_exts&&allowed_exts!=""){var txt_all_files=typeof geodir_params.txt_all_files!="undefined"&&geodir_params.txt_all_files!=""?geodir_params.txt_all_files:"Allowed files";pconfig["filters"]=[{title:txt_all_files,extensions:allowed_exts}]}var uploader=new plupload.Uploader(pconfig);uploader.bind("Init",function(up){});uploader.bind("Init",function(up,params){if(uploader.features.dragdrop){var drop_id=imgId+"dropbox";var target=jQuery("#"+drop_id);target.on("dragenter",function(event){target.addClass("dragover")});target.on("dragleave",function(event){target.removeClass("dragover")});target.on("drop",function(){target.removeClass("dragover")})}});uploader.init();uploader.bind("Error",function(up,files){if(files.code==-600){jQuery("#"+imgId+"upload-error").addClass("upload-error");if(typeof geodir_params.err_max_file_size!="undefined"&&geodir_params.err_max_file_size!=""){msgErr=geodir_params.err_max_file_size}else{msgErr="File size error : You tried to upload a file over %s"}msgErr=msgErr.replace("%s",geodir_plupload_params.upload_img_size);jQuery("#"+imgId+"upload-error").html(msgErr)}else if(files.code==-601){jQuery("#"+imgId+"upload-error").addClass("upload-error");if(typeof geodir_params.err_file_type!="undefined"&&geodir_params.err_file_type!=""){msgErr=geodir_params.err_file_type}else{msgErr="File type error. Allowed file types: %s"}if(imgId=="post_images"){var txtReplace=allowed_exts!=""?"."+allowed_exts.replace(/,/g,", ."):"*";msgErr=msgErr.replace("%s",txtReplace)}else{msgErr=msgErr.replace("%s",jQuery("#"+imgId+"_allowed_types").attr("data-exts"))}jQuery("#"+imgId+"upload-error").html(msgErr)}else{jQuery("#"+imgId+"upload-error").addClass("upload-error");jQuery("#"+imgId+"upload-error").html(files.message)}});uploader.bind("FilesAdded",function(up,files){var totalImg=parseInt(jQuery("#"+imgId+"totImg").val());var limitImg=parseInt(jQuery("#"+imgId+"image_limit").val());jQuery("#"+imgId+"upload-error").html("");jQuery("#"+imgId+"upload-error").removeClass("upload-error");if(limitImg&&$this.hasClass("plupload-upload-uic-multiple")&&limitImg>0){if(totalImg>=limitImg&&limitImg>0){while(up.files.length>0){up.removeFile(up.files[0])}if(typeof geodir_params.err_file_upload_limit!="undefined"&&geodir_params.err_file_upload_limit!=""){msgErr=geodir_params.err_file_upload_limit}else{msgErr="You have reached your upload limit of %s files."}msgErr=msgErr.replace("%s",limitImg);jQuery("#"+imgId+"upload-error").addClass("upload-error");jQuery("#"+imgId+"upload-error").html(msgErr);return false}if(up.files.length>limitImg&&limitImg>0){while(up.files.length>0){up.removeFile(up.files[0])}if(typeof geodir_params.err_pkg_upload_limit!="undefined"&&geodir_params.err_pkg_upload_limit!=""){msgErr=geodir_params.err_pkg_upload_limit}else{msgErr="You may only upload %s files with this package, please try again."}msgErr=msgErr.replace("%s",limitImg);jQuery("#"+imgId+"upload-error").addClass("upload-error");jQuery("#"+imgId+"upload-error").html(msgErr);return false}}$.each(files,function(i,file){$this.find(".filelist").append('<div class="file" id="'+file.id+'"><b>'+file.name+"</b> (<span>"+plupload.formatSize(0)+"</span>/"+plupload.formatSize(file.size)+") "+'<div class="fileprogress"></div></div>')});up.refresh();up.start()});uploader.bind("UploadProgress",function(up,file){$("#"+file.id+" .fileprogress").width(file.percent+"%");$("#"+file.id+" span").html(plupload.formatSize(parseInt(file.size*file.percent/100)))});var timer;var i=0;var indexes=new Array;uploader.bind("FileUploaded",function(up,file,response){var totalImg=parseInt(jQuery("#"+imgId+"totImg").val());indexes[i]=up;clearInterval(timer);timer=setTimeout(function(){},1e3);i++;$("#"+file.id).fadeOut();response=response["response"];if($this.hasClass("plupload-upload-uic-multiple")){totalImg++;jQuery("#"+imgId+"totImg").val(totalImg);var v1=$.trim($("#"+imgId,$("#"+imgId+"plupload-upload-ui").parent()).val());if(v1){v1=v1+","+response}else{v1=response}$("#"+imgId,$("#"+imgId+"plupload-upload-ui").parent()).val(v1)}else{$("#"+imgId,$("#"+imgId+"plupload-upload-ui").parent()).val(response+"")}plu_show_thumbs(imgId)})})}});function geodir_esc_entities(str){var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(str).replace(/[&<>"'`=\/]/g,function(s){return entityMap[s]})}function geodir_remove_file_index(indexes){for(var i=0;i<indexes.length;i++){if(indexes[i].files.length>0){indexes[i].removeFile(indexes[i].files[0])}}}function plu_show_thumbs(imgId){var totalImg=parseInt(jQuery("#"+imgId+"totImg").val());var limitImg=parseInt(jQuery("#"+imgId+"image_limit").val());var $=jQuery;var thumbsC=$("#"+imgId+"plupload-thumbs");thumbsC.html("");var imagesS=$("#"+imgId,$("#"+imgId+"plupload-upload-ui").parent()).val();var txtRemove="Remove";if(typeof geodir_params.action_remove!="undefined"&&geodir_params.action_remove!=""){txtRemove=geodir_params.action_remove}if(!imagesS){return}var images=imagesS.split(",");for(var i=0;i<images.length;i++){if(images[i]&&images[i]!="null"){var img_arr=images[i].split("|");var image_url=img_arr[0];var image_id=img_arr[1];var image_title=img_arr[2];var image_caption=img_arr[3];var image_title_html="";var image_caption_html="";if(typeof image_id==="undefined"){image_id=""}if(typeof image_title==="undefined"){image_title=""}if(typeof image_caption==="undefined"){image_caption=""}image_title=geodir_esc_entities(image_title);image_caption=geodir_esc_entities(image_caption);var file_ext=image_url.substring(images[i].lastIndexOf(".")+1);file_ext=file_ext.split("?").shift();var fileNameIndex=image_url.lastIndexOf("/")+1;var dotIndex=image_url.lastIndexOf(".");if(dotIndex<fileNameIndex){continue}var file_name=image_url.substr(fileNameIndex,dotIndex<fileNameIndex?loc.length:dotIndex);var file_display="";var file_display_class="";if(file_ext=="jpg"||file_ext=="jpe"||file_ext=="jpeg"||file_ext=="png"||file_ext=="gif"||file_ext=="bmp"||file_ext=="ico"){file_display='<img class="gd-file-info" data-id="'+image_id+'" data-title="'+image_title+'" data-caption="'+image_caption+'" data-src="'+image_url+'" src="'+image_url+'" alt=""  />';if(!!image_title.trim()){image_title_html='<span class="gd-title-preview">'+image_title+"</span>"}if(!!image_caption.trim()){image_caption_html='<span class="gd-caption-preview">'+image_caption+"</span>"}}else{var file_type_class="fa-file";if(file_ext=="pdf"){file_type_class="fa-file-pdf"}else if(file_ext=="zip"||file_ext=="tar"){file_type_class="fa-file-archive"}else if(file_ext=="doc"||file_ext=="odt"){file_type_class="fa-file-word"}else if(file_ext=="txt"||file_ext=="text"){file_type_class="fa-file-text"}else if(file_ext=="csv"||file_ext=="ods"||file_ext=="ots"){file_type_class="fa-file-excel"}else if(file_ext=="avi"||file_ext=="mp4"||file_ext=="mov"){file_type_class="fa-file-video"}file_display_class="file-thumb";file_display='<i title="'+file_name+'" class="fa '+file_type_class+' gd-file-info" data-id="'+image_id+'" data-title="'+image_title+'" data-caption="'+image_caption+'" data-src="'+image_url+'" aria-hidden="true"></i>'}var thumb=$('<div class="thumb '+file_display_class+'" id="thumb'+imgId+i+'">'+image_title_html+file_display+image_caption_html+'<div class="gd-thumb-actions">'+'<span class="thumbeditlink" onclick="gd_edit_image_meta('+imgId+","+i+');"><i class="far fa-edit" aria-hidden="true"></i></span>'+'<span class="thumbremovelink" id="thumbremovelink'+imgId+i+'"><i class="fas fa-trash-alt" aria-hidden="true"></i></span>'+"</div>"+"</div>");thumbsC.append(thumb);thumb.find(".thumbremovelink").click(function(){if(jQuery("#"+imgId+"plupload-upload-ui").hasClass("plupload-upload-uic-multiple")){totalImg--;jQuery("#"+imgId+"totImg").val(totalImg)}jQuery("#"+imgId+"upload-error").html("");jQuery("#"+imgId+"upload-error").removeClass("upload-error");var ki=$(this).attr("id").replace("thumbremovelink"+imgId,"");ki=parseInt(ki);var kimages=[];imagesS=$("#"+imgId,$("#"+imgId+"plupload-upload-ui").parent()).val();images=imagesS.split(",");for(var j=0;j<images.length;j++){if(j!=ki){kimages[kimages.length]=images[j]}}$("#"+imgId,$("#"+imgId+"plupload-upload-ui").parent()).val(kimages.join());plu_show_thumbs(imgId);return false})}}if(images.length>1){thumbsC.sortable({update:function(event,ui){var kimages=[];thumbsC.find(".gd-file-info").each(function(){kimages[kimages.length]=$(this).data("src")+"|"+$(this).data("id")+"|"+$(this).data("title")+"|"+$(this).data("caption");$("#"+imgId,$("#"+imgId+"plupload-upload-ui").parent()).val(kimages.join());plu_show_thumbs(imgId)})}});thumbsC.disableSelection()}var kimages=[];thumbsC.find(".gd-file-info").each(function(){kimages[kimages.length]=$(this).data("src")+"|"+$(this).data("id")+"|"+$(this).data("title")+"|"+$(this).data("caption");$("#"+imgId,$("#"+imgId+"plupload-upload-ui").parent()).val(kimages.join())})}function gd_edit_image_meta(input,order_id){var imagesS=jQuery("#"+input.id,jQuery("#"+input.id+"plupload-upload-ui").parent()).val();var images=imagesS.split(",");var img_arr=images[order_id].split("|");var image_title=img_arr[2];var image_caption=img_arr[3];var html="";html=html+"<div class='gd-modal-text'><label for='gd-image-meta-title'>"+geodir_params.label_title+"</label><input id='gd-image-meta-title' value='"+image_title+"'></div>";html=html+"<div class='gd-modal-text'><label for='gd-image-meta-caption'>"+geodir_params.label_caption+"</label><input id='gd-image-meta-caption' value='"+image_caption+"'></div>";html=html+"<div class='gd-modal-button'><button class='button button-primary button-large' onclick='gd_set_image_meta(\""+input.id+'",'+order_id+")'>"+geodir_params.button_set+"</button></div>";jQuery("#gd-image-meta-input").html(html);lity("#gd-image-meta-input")}function gd_set_image_meta(input_id,order_id){var imagesS=jQuery("#"+input_id,jQuery("#"+input_id+"plupload-upload-ui").parent()).val();var images=imagesS.split(",");var img_arr=images[order_id].split("|");var image_url=img_arr[0];var image_id=img_arr[1];var image_title=geodir_esc_entities(jQuery("#gd-image-meta-title").val());var image_caption=geodir_esc_entities(jQuery("#gd-image-meta-caption").val());images[order_id]=image_url+"|"+image_id+"|"+image_title+"|"+image_caption;imagesS=images.join(",");jQuery("#"+input_id,jQuery("#"+input_id+"plupload-upload-ui").parent()).val(imagesS);plu_show_thumbs(input_id);jQuery("[data-lity-close]",window.parent.document).trigger("click")}
function geodir_remove_file_index(a){for(var e=0;e<a.length;e++)a[e].files.length>0&&a[e].removeFile(a[e].files[0])}function plu_show_thumbs(a){var e=parseInt(jQuery("#"+a+"totImg").val()),i=(parseInt(jQuery("#"+a+"image_limit").val()),jQuery),l=i("#"+a+"plupload-thumbs");l.html("");var r=i("#"+a,i("#"+a+"plupload-upload-ui").parent()).val();if(void 0!==geodir_params.action_remove&&""!=geodir_params.action_remove&&geodir_params.action_remove,r){for(var t=r.split("::"),o=0;o<t.length;o++)if(t[o]&&"null"!=t[o]){var d=t[o].split("|"),p=d[0],s=d[1],u=d[2],n=d[3];void 0===s&&(s=""),void 0===u&&(u=""),void 0===n&&(n="");var m=p.substring(t[o].lastIndexOf(".")+1);m=m.split("?").shift();var _=p.lastIndexOf("/")+1,f=p.lastIndexOf(".");if(f<_)continue;var g=p.substr(_,f<_?loc.length:f),v="",c="";if("jpg"==m||"jpe"==m||"jpeg"==m||"png"==m||"gif"==m||"bmp"==m||"ico"==m)v='<img class="gd-file-info" data-id="'+s+'" data-title="'+u+'" data-caption="'+n+'" data-src="'+p+'" src="'+p+'" alt=""  />';else{var h="fa-file";"pdf"==m?h="fa-file-pdf":"zip"==m||"tar"==m?h="fa-file-archive":"doc"==m||"odt"==m?h="fa-file-word":"txt"==m||"text"==m?h="fa-file-text":"csv"==m||"ods"==m||"ots"==m?h="fa-file-excel":"avi"!=m&&"mp4"!=m&&"mov"!=m||(h="fa-file-video"),c="file-thumb",v='<i title="'+g+'" class="fa '+h+' gd-file-info" data-id="'+s+'" data-title="'+u+'" data-caption="'+n+'" data-src="'+p+'" aria-hidden="true"></i>'}var y=i('<div class="thumb '+c+'" id="thumb'+a+o+'">'+v+'<div class="gd-thumb-actions"><span class="thumbeditlink" onclick="gd_edit_image_meta('+a+","+o+');"><i class="far fa-edit" aria-hidden="true"></i></span><span class="thumbremovelink" id="thumbremovelink'+a+o+'"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></div></div>');l.append(y),y.find(".thumbremovelink").click(function(){jQuery("#"+a+"plupload-upload-ui").hasClass("plupload-upload-uic-multiple")&&(e--,jQuery("#"+a+"totImg").val(e)),jQuery("#"+a+"upload-error").html(""),jQuery("#"+a+"upload-error").removeClass("upload-error");var l=i(this).attr("id").replace("thumbremovelink"+a,"");l=parseInt(l);var o=[];r=i("#"+a,i("#"+a+"plupload-upload-ui").parent()).val(),t=r.split("::");for(var d=0;d<t.length;d++)d!=l&&(o[o.length]=t[d]);return i("#"+a,i("#"+a+"plupload-upload-ui").parent()).val(o.join("::")),plu_show_thumbs(a),!1})}t.length>1&&(l.sortable({update:function(e,r){var t=[];l.find(".gd-file-info").each(function(){t[t.length]=i(this).data("src")+"|"+i(this).data("id")+"|"+i(this).data("title")+"|"+i(this).data("caption"),i("#"+a,i("#"+a+"plupload-upload-ui").parent()).val(t.join("::")),plu_show_thumbs(a)})}}),l.disableSelection());var b=[];l.find(".gd-file-info").each(function(){b[b.length]=i(this).data("src")+"|"+i(this).data("id")+"|"+i(this).data("title")+"|"+i(this).data("caption"),i("#"+a,i("#"+a+"plupload-upload-ui").parent()).val(b.join("::"))})}}function gd_edit_image_meta(a,e){var i=jQuery("#"+a.id,jQuery("#"+a.id+"plupload-upload-ui").parent()).val().split("::")[e].split("|"),l=i[2],r=i[3],t="";t=(t=(t=t+"<div class='gd-modal-text'><label for='gd-image-meta-title'>"+geodir_params.label_title+"</label><input id='gd-image-meta-title' value='"+l+"'></div>")+"<div class='gd-modal-text'><label for='gd-image-meta-caption'>"+geodir_params.label_caption+"</label><input id='gd-image-meta-caption' value='"+r+"'></div>")+"<div class='gd-modal-button'><button class='button button-primary button-large' onclick='gd_set_image_meta(\""+a.id+'",'+e+")'>"+geodir_params.button_set+"</button></div>",jQuery("#gd-image-meta-input").html(t),lity("#gd-image-meta-input")}function gd_set_image_meta(a,e){var i=jQuery("#"+a,jQuery("#"+a+"plupload-upload-ui").parent()).val(),l=i.split("::"),r=l[e].split("|"),t=r[0],o=r[1],d=jQuery("#gd-image-meta-title").val(),p=jQuery("#gd-image-meta-caption").val();l[e]=t+"|"+o+"|"+d+"|"+p,i=l.join("::"),jQuery("#"+a,jQuery("#"+a+"plupload-upload-ui").parent()).val(i),plu_show_thumbs(a),jQuery("[data-lity-close]",window.parent.document).trigger("click")}jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery(document).ready(function(a){if(a(".plupload-upload-uic").exists()){var e=!1,i="",l="";if(jQuery("#geodirectory-add-post input[name='ID']").length)l=jQuery("#geodirectory-add-post input[name='ID']").val();else l=jQuery("#post input[name='post_ID']").val();a(".plupload-upload-uic").each(function(){var r=a(this),t=r.attr("id").replace("plupload-upload-ui","");plu_show_thumbs(t),(e=JSON.parse(geodir_plupload_params.base_plupload_config)).browse_button=t+e.browse_button,e.container=t+e.container,jQuery("#"+t+"dropbox").length&&(e.drop_element=t+"dropbox"),e.file_data_name=t+e.file_data_name,e.multipart_params.imgid=t,e.multipart_params.post_id=l,r.hasClass("plupload-upload-uic-multiple")&&(e.multi_selection=!0);var o=jQuery("#"+t+"_allowed_types").val();if(o=o&&""!=o?o:"","post_images"==t&&void 0!==geodir_params.gd_allowed_img_types&&""!=geodir_params.gd_allowed_img_types&&(o=geodir_params.gd_allowed_img_types),o&&""!=o){var d=void 0!==geodir_params.txt_all_files&&""!=geodir_params.txt_all_files?geodir_params.txt_all_files:"Allowed files";e.filters=[{title:d,extensions:o}]}var p,s=new plupload.Uploader(e);s.bind("Init",function(a){}),s.bind("Init",function(a,e){if(s.features.dragdrop){var i=jQuery("#"+(t+"dropbox"));i.on("dragenter",function(a){i.addClass("dragover")}),i.on("dragleave",function(a){i.removeClass("dragover")}),i.on("drop",function(){i.removeClass("dragover")})}}),s.init(),s.bind("Error",function(a,e){if(-600==e.code)jQuery("#"+t+"upload-error").addClass("upload-error"),i=(i=void 0!==geodir_params.err_max_file_size&&""!=geodir_params.err_max_file_size?geodir_params.err_max_file_size:"File size error : You tried to upload a file over %s").replace("%s",geodir_plupload_params.upload_img_size),jQuery("#"+t+"upload-error").html(i);else if(-601==e.code){if(jQuery("#"+t+"upload-error").addClass("upload-error"),i=void 0!==geodir_params.err_file_type&&""!=geodir_params.err_file_type?geodir_params.err_file_type:"File type error. Allowed file types: %s","post_images"==t){var l=""!=o?"."+o.replace(/,/g,", ."):"*";i=i.replace("%s",l)}else i=i.replace("%s",jQuery("#"+t+"_allowed_types").attr("data-exts"));jQuery("#"+t+"upload-error").html(i)}else jQuery("#"+t+"upload-error").addClass("upload-error"),jQuery("#"+t+"upload-error").html(e.message)}),s.bind("FilesAdded",function(e,l){var o=parseInt(jQuery("#"+t+"totImg").val()),d=parseInt(jQuery("#"+t+"image_limit").val());if(jQuery("#"+t+"upload-error").html(""),jQuery("#"+t+"upload-error").removeClass("upload-error"),d&&r.hasClass("plupload-upload-uic-multiple")&&d>0){if(o>=d&&d>0){for(;e.files.length>0;)e.removeFile(e.files[0]);return i=(i=void 0!==geodir_params.err_file_upload_limit&&""!=geodir_params.err_file_upload_limit?geodir_params.err_file_upload_limit:"You have reached your upload limit of %s files.").replace("%s",d),jQuery("#"+t+"upload-error").addClass("upload-error"),jQuery("#"+t+"upload-error").html(i),!1}if(e.files.length>d&&d>0){for(;e.files.length>0;)e.removeFile(e.files[0]);return i=(i=void 0!==geodir_params.err_pkg_upload_limit&&""!=geodir_params.err_pkg_upload_limit?geodir_params.err_pkg_upload_limit:"You may only upload %s files with this package, please try again.").replace("%s",d),jQuery("#"+t+"upload-error").addClass("upload-error"),jQuery("#"+t+"upload-error").html(i),!1}}a.each(l,function(a,e){r.find(".filelist").append('<div class="file" id="'+e.id+'"><b>'+e.name+"</b> (<span>"+plupload.formatSize(0)+"</span>/"+plupload.formatSize(e.size)+') <div class="fileprogress"></div></div>')}),e.refresh(),e.start()}),s.bind("UploadProgress",function(e,i){a("#"+i.id+" .fileprogress").width(i.percent+"%"),a("#"+i.id+" span").html(plupload.formatSize(parseInt(i.size*i.percent/100)))});var u=0,n=new Array;s.bind("FileUploaded",function(e,i,l){var o=parseInt(jQuery("#"+t+"totImg").val());if(n[u]=e,clearInterval(p),p=setTimeout(function(){},1e3),u++,a("#"+i.id).fadeOut(),l=l.response,r.hasClass("plupload-upload-uic-multiple")){o++,jQuery("#"+t+"totImg").val(o);var d=a.trim(a("#"+t,a("#"+t+"plupload-upload-ui").parent()).val());d=d?d+","+l:l,a("#"+t,a("#"+t+"plupload-upload-ui").parent()).val(d)}else a("function geodir_remove_file_index(a){for(var e=0;e<a.length;e++)a[e].files.length>0&&a[e].removeFile(a[e].files[0])}function plu_show_thumbs(a){var e=parseInt(jQuery(\"#\"+a+\"totImg\").val()),i=(parseInt(jQuery(\"#\"+a+\"image_limit\").val()),jQuery),l=i(\"#\"+a+\"plupload-thumbs\");l.html(\"\");var r=i(\"#\"+a,i(\"#\"+a+\"plupload-upload-ui\").parent()).val();if(void 0!==geodir_params.action_remove&&\"\"!=geodir_params.action_remove&&geodir_params.action_remove,r){for(var t=r.split(\"::\"),o=0;o<t.length;o++)if(t[o]&&\"null\"!=t[o]){var d=t[o].split(\"|\"),p=d[0],s=d[1],u=d[2],n=d[3];void 0===s&&(s=\"\"),void 0===u&&(u=\"\"),void 0===n&&(n=\"\");var m=p.substring(t[o].lastIndexOf(\".\")+1);m=m.split(\"?\").shift();var _=p.lastIndexOf(\"/\")+1,f=p.lastIndexOf(\".\");if(f<_)continue;var g=p.substr(_,f<_?loc.length:f),v=\"\",c=\"\";if(\"jpg\"==m||\"jpe\"==m||\"jpeg\"==m||\"png\"==m||\"gif\"==m||\"bmp\"==m||\"ico\"==m)v='<img class=\"gd-file-info\" data-id=\"'+s+'\" data-title=\"'+u+'\" data-caption=\"'+n+'\" data-src=\"'+p+'\" src=\"'+p+'\" alt=\"\"  />';else{var h=\"fa-file\";\"pdf\"==m?h=\"fa-file-pdf\":\"zip\"==m||\"tar\"==m?h=\"fa-file-archive\":\"doc\"==m||\"odt\"==m?h=\"fa-file-word\":\"txt\"==m||\"text\"==m?h=\"fa-file-text\":\"csv\"==m||\"ods\"==m||\"ots\"==m?h=\"fa-file-excel\":\"avi\"!=m&&\"mp4\"!=m&&\"mov\"!=m||(h=\"fa-file-video\"),c=\"file-thumb\",v='<i title=\"'+g+'\" class=\"fa '+h+' gd-file-info\" data-id=\"'+s+'\" data-title=\"'+u+'\" data-caption=\"'+n+'\" data-src=\"'+p+'\" aria-hidden=\"true\"></i>'}var y=i('<div class=\"thumb '+c+'\" id=\"thumb'+a+o+'\">'+v+'<div class=\"gd-thumb-actions\"><span class=\"thumbeditlink\" onclick=\"gd_edit_image_meta('+a+\",\"+o+');\"><i class=\"far fa-edit\" aria-hidden=\"true\"></i></span><span class=\"thumbremovelink\" id=\"thumbremovelink'+a+o+'\"><i class=\"fas fa-trash-alt\" aria-hidden=\"true\"></i></span></div></div>');l.append(y),y.find(\".thumbremovelink\").click(function(){jQuery(\"#\"+a+\"plupload-upload-ui\").hasClass(\"plupload-upload-uic-multiple\")&&(e--,jQuery(\"#\"+a+\"totImg\").val(e)),jQuery(\"#\"+a+\"upload-error\").html(\"\"),jQuery(\"#\"+a+\"upload-error\").removeClass(\"upload-error\");var l=i(this).attr(\"id\").replace(\"thumbremovelink\"+a,\"\");l=parseInt(l);var o=[];r=i(\"#\"+a,i(\"#\"+a+\"plupload-upload-ui\").parent()).val(),t=r.split(\"::\");for(var d=0;d<t.length;d++)d!=l&&(o[o.length]=t[d]);return i(\"#\"+a,i(\"#\"+a+\"plupload-upload-ui\").parent()).val(o.join(\"::\")),plu_show_thumbs(a),!1})}t.length>1&&(l.sortable({update:function(e,r){var t=[];l.find(\".gd-file-info\").each(function(){t[t.length]=i(this).data(\"src\")+\"|\"+i(this).data(\"id\")+\"|\"+i(this).data(\"title\")+\"|\"+i(this).data(\"caption\"),i(\"#\"+a,i(\"#\"+a+\"plupload-upload-ui\").parent()).val(t.join(\"::\")),plu_show_thumbs(a)})}}),l.disableSelection());var b=[];l.find(\".gd-file-info\").each(function(){b[b.length]=i(this).data(\"src\")+\"|\"+i(this).data(\"id\")+\"|\"+i(this).data(\"title\")+\"|\"+i(this).data(\"caption\"),i(\"#\"+a,i(\"#\"+a+\"plupload-upload-ui\").parent()).val(b.join(\"::\"))})}}function gd_edit_image_meta(a,e){var i=jQuery(\"#\"+a.id,jQuery(\"#\"+a.id+\"plupload-upload-ui\").parent()).val().split(\"::\")[e].split(\"|\"),l=i[2],r=i[3],t=\"\";t=(t=(t=t+\"<div class='gd-modal-text'><label for='gd-image-meta-title'>\"+geodir_params.label_title+\"</label><input id='gd-image-meta-title' value='\"+l+\"'></div>\")+\"<div class='gd-modal-text'><label for='gd-image-meta-caption'>\"+geodir_params.label_caption+\"</label><input id='gd-image-meta-caption' value='\"+r+\"'></div>\")+\"<div class='gd-modal-button'><button class='button button-primary button-large' onclick='gd_set_image_meta(\\\"\"+a.id+'\",'+e+\")'>\"+geodir_params.button_set+\"</button></div>\",jQuery(\"#gd-image-meta-input\").html(t),lity(\"#gd-image-meta-input\")}function gd_set_image_meta(a,e){var i=jQuery(\"#\"+a,jQuery(\"#\"+a+\"plupload-upload-ui\").parent()).val(),l=i.split(\"::\"),r=l[e].split(\"|\"),t=r[0],o=r[1],d=jQuery(\"#gd-image-meta-title\").val(),p=jQuery(\"#gd-image-meta-caption\").val();l[e]=t+\"|\"+o+\"|\"+d+\"|\"+p,i=l.join(\"::\"),jQuery(\"#\"+a,jQuery(\"#\"+a+\"plupload-upload-ui\").parent()).val(i),plu_show_thumbs(a),jQuery(\"[data-lity-close]\",window.parent.document).trigger(\"click\")}jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery(document).ready(function(a){if(a(\".plupload-upload-uic\").exists()){var e=!1,i=\"\",l=\"\";if(jQuery(\"#geodirectory-add-post input[name='ID']\").length)l=jQuery(\"#geodirectory-add-post input[name='ID']\").val();else l=jQuery(\"#post input[name='post_ID']\").val();a(\".plupload-upload-uic\").each(function(){var r=a(this),t=r.attr(\"id\").replace(\"plupload-upload-ui\",\"\");plu_show_thumbs(t),(e=JSON.parse(geodir_plupload_params.base_plupload_config)).browse_button=t+e.browse_button,e.container=t+e.container,jQuery(\"#\"+t+\"dropbox\").length&&(e.drop_element=t+\"dropbox\"),e.file_data_name=t+e.file_data_name,e.multipart_params.imgid=t,e.multipart_params.post_id=l,r.hasClass(\"plupload-upload-uic-multiple\")&&(e.multi_selection=!0);var o=jQuery(\"#\"+t+\"_allowed_types\").val();if(o=o&&\"\"!=o?o:\"\",\"post_images\"==t&&void 0!==geodir_params.gd_allowed_img_types&&\"\"!=geodir_params.gd_allowed_img_types&&(o=geodir_params.gd_allowed_img_types),o&&\"\"!=o){var d=void 0!==geodir_params.txt_all_files&&\"\"!=geodir_params.txt_all_files?geodir_params.txt_all_files:\"Allowed files\";e.filters=[{title:d,extensions:o}]}var p,s=new plupload.Uploader(e);s.bind(\"Init\",function(a){}),s.bind(\"Init\",function(a,e){if(s.features.dragdrop){var i=jQuery(\"#\"+(t+\"dropbox\"));i.on(\"dragenter\",function(a){i.addClass(\"dragover\")}),i.on(\"dragleave\",function(a){i.removeClass(\"dragover\")}),i.on(\"drop\",function(){i.removeClass(\"dragover\")})}}),s.init(),s.bind(\"Error\",function(a,e){if(-600==e.code)jQuery(\"#\"+t+\"upload-error\").addClass(\"upload-error\"),i=(i=void 0!==geodir_params.err_max_file_size&&\"\"!=geodir_params.err_max_file_size?geodir_params.err_max_file_size:\"File size error : You tried to upload a file over %s\").replace(\"%s\",geodir_plupload_params.upload_img_size),jQuery(\"#\"+t+\"upload-error\").html(i);else if(-601==e.code){if(jQuery(\"#\"+t+\"upload-error\").addClass(\"upload-error\"),i=void 0!==geodir_params.err_file_type&&\"\"!=geodir_params.err_file_type?geodir_params.err_file_type:\"File type error. Allowed file types: %s\",\"post_images\"==t){var l=\"\"!=o?\".\"+o.replace(/,/g,\", .\"):\"*\";i=i.replace(\"%s\",l)}else i=i.replace(\"%s\",jQuery(\"#\"+t+\"_allowed_types\").attr(\"data-exts\"));jQuery(\"#\"+t+\"upload-error\").html(i)}else jQuery(\"#\"+t+\"upload-error\").addClass(\"upload-error\"),jQuery(\"#\"+t+\"upload-error\").html(e.message)}),s.bind(\"FilesAdded\",function(e,l){var o=parseInt(jQuery(\"#\"+t+\"totImg\").val()),d=parseInt(jQuery(\"#\"+t+\"image_limit\").val());if(jQuery(\"#\"+t+\"upload-error\").html(\"\"),jQuery(\"#\"+t+\"upload-error\").removeClass(\"upload-error\"),d&&r.hasClass(\"plupload-upload-uic-multiple\")&&d>0){if(o>=d&&d>0){for(;e.files.length>0;)e.removeFile(e.files[0]);return i=(i=void 0!==geodir_params.err_file_upload_limit&&\"\"!=geodir_params.err_file_upload_limit?geodir_params.err_file_upload_limit:\"You have reached your upload limit of %s files.\").replace(\"%s\",d),jQuery(\"#\"+t+\"upload-error\").addClass(\"upload-error\"),jQuery(\"#\"+t+\"upload-error\").html(i),!1}if(e.files.length>d&&d>0){for(;e.files.length>0;)e.removeFile(e.files[0]);return i=(i=void 0!==geodir_params.err_pkg_upload_limit&&\"\"!=geodir_params.err_pkg_upload_limit?geodir_params.err_pkg_upload_limit:\"You may only upload %s files with this package, please try again.\").replace(\"%s\",d),jQuery(\"#\"+t+\"upload-error\").addClass(\"upload-error\"),jQuery(\"#\"+t+\"upload-error\").html(i),!1}}a.each(l,function(a,e){r.find(\".filelist\").append('<div class=\"file\" id=\"'+e.id+'\"><b>'+e.name+\"</b> (<span>\"+plupload.formatSize(0)+\"</span>/\"+plupload.formatSize(e.size)+') <div class=\"fileprogress\"></div></div>')}),e.refresh(),e.start()}),s.bind(\"UploadProgress\",function(e,i){a(\"#\"+i.id+\" .fileprogress\").width(i.percent+\"%\"),a(\"#\"+i.id+\" span\").html(plupload.formatSize(parseInt(i.size*i.percent/100)))});var u=0,n=new Array;s.bind(\"FileUploaded\",function(e,i,l){var o=parseInt(jQuery(\"#\"+t+\"totImg\").val());if(n[u]=e,clearInterval(p),p=setTimeout(function(){},1e3),u++,a(\"#\"+i.id).fadeOut(),l=l.response,r.hasClass(\"plupload-upload-uic-multiple\")){o++,jQuery(\"#\"+t+\"totImg\").val(o);var d=a.trim(a(\"#\"+t,a(\"#\"+t+\"plupload-upload-ui\").parent()).val());d=d?d+\",\"+l:l,a(\"#\"+t,a(\"#\"+t+\"plupload-upload-ui\").parent()).val(d)}else a(\"#\"+t,a(\"#\"+t+\"plupload-upload-ui\").parent()).val(l+\"\");plu_show_thumbs(t)})})}});"+t,a("#"+t+"plupload-upload-ui").parent()).val(l+"");plu_show_thumbs(t)})})}});
