function geodir_remove_file_index(a){for(var e=0;e<a.length;e++)a[e].files.length>0&&a[e].removeFile(a[e].files[0])}function plu_show_thumbs(a){var e=parseInt(jQuery("#"+a+"totImg").val()),i=(parseInt(jQuery("#"+a+"image_limit").val()),jQuery),l=i("#"+a+"plupload-thumbs");l.html("");var r=i("#"+a,i("#"+a+"plupload-upload-ui").parent()).val();if(void 0!==geodir_params.action_remove&&""!=geodir_params.action_remove&&geodir_params.action_remove,r){for(var t=r.split("::"),o=0;o<t.length;o++)if(t[o]&&"null"!=t[o]){var d=t[o].split("|"),p=d[0],s=d[1],u=d[2],n=d[3];void 0===s&&(s=""),void 0===u&&(u=""),void 0===n&&(n="");var m=p.substring(t[o].lastIndexOf(".")+1);m=m.split("?").shift();var _=p.lastIndexOf("/")+1,f=p.lastIndexOf(".");if(f<_)continue;var g=p.substr(_,f<_?loc.length:f),v="",c="";if("jpg"==m||"jpe"==m||"jpeg"==m||"png"==m||"gif"==m||"bmp"==m||"ico"==m)v='<img class="gd-file-info" data-id="'+s+'" data-title="'+u+'" data-caption="'+n+'" data-src="'+p+'" src="'+p+'" alt=""  />';else{var h="fa-file";"pdf"==m?h="fa-file-pdf":"zip"==m||"tar"==m?h="fa-file-archive":"doc"==m||"odt"==m?h="fa-file-word":"txt"==m||"text"==m?h="fa-file-text":"csv"==m||"ods"==m||"ots"==m?h="fa-file-excel":"avi"!=m&&"mp4"!=m&&"mov"!=m||(h="fa-file-video"),c="file-thumb",v='<i title="'+g+'" class="fa '+h+' gd-file-info" data-id="'+s+'" data-title="'+u+'" data-caption="'+n+'" data-src="'+p+'" aria-hidden="true"></i>'}var y=i('<div class="thumb '+c+'" id="thumb'+a+o+'">'+v+'<div class="gd-thumb-actions"><span class="thumbeditlink" onclick="gd_edit_image_meta('+a+","+o+');"><i class="far fa-edit" aria-hidden="true"></i></span><span class="thumbremovelink" id="thumbremovelink'+a+o+'"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></div></div>');l.append(y),y.find(".thumbremovelink").click(function(){jQuery("#"+a+"plupload-upload-ui").hasClass("plupload-upload-uic-multiple")&&(e--,jQuery("#"+a+"totImg").val(e)),jQuery("#"+a+"upload-error").html(""),jQuery("#"+a+"upload-error").removeClass("upload-error");var l=i(this).attr("id").replace("thumbremovelink"+a,"");l=parseInt(l);var o=[];r=i("#"+a,i("#"+a+"plupload-upload-ui").parent()).val(),t=r.split("::");for(var d=0;d<t.length;d++)d!=l&&(o[o.length]=t[d]);return i("#"+a,i("#"+a+"plupload-upload-ui").parent()).val(o.join("::")),plu_show_thumbs(a),!1})}t.length>1&&(l.sortable({update:function(e,r){var t=[];l.find(".gd-file-info").each(function(){t[t.length]=i(this).data("src")+"|"+i(this).data("id")+"|"+i(this).data("title")+"|"+i(this).data("caption"),i("#"+a,i("#"+a+"plupload-upload-ui").parent()).val(t.join("::")),plu_show_thumbs(a)})}}),l.disableSelection());var b=[];l.find(".gd-file-info").each(function(){b[b.length]=i(this).data("src")+"|"+i(this).data("id")+"|"+i(this).data("title")+"|"+i(this).data("caption"),i("#"+a,i("#"+a+"plupload-upload-ui").parent()).val(b.join("::"))})}}function gd_edit_image_meta(a,e){var i=jQuery("#"+a.id,jQuery("#"+a.id+"plupload-upload-ui").parent()).val().split("::")[e].split("|"),l=i[2],r=i[3],t="";t=(t=(t=t+"<div class='gd-modal-text'><label for='gd-image-meta-title'>"+geodir_params.label_title+"</label><input id='gd-image-meta-title' value='"+l+"'></div>")+"<div class='gd-modal-text'><label for='gd-image-meta-caption'>"+geodir_params.label_caption+"</label><input id='gd-image-meta-caption' value='"+r+"'></div>")+"<div class='gd-modal-button'><button class='button button-primary button-large' onclick='gd_set_image_meta(\""+a.id+'",'+e+")'>"+geodir_params.button_set+"</button></div>",jQuery("#gd-image-meta-input").html(t),lity("#gd-image-meta-input")}function gd_set_image_meta(a,e){var i=jQuery("#"+a,jQuery("#"+a+"plupload-upload-ui").parent()).val(),l=i.split("::"),r=l[e].split("|"),t=r[0],o=r[1],d=jQuery("#gd-image-meta-title").val(),p=jQuery("#gd-image-meta-caption").val();l[e]=t+"|"+o+"|"+d+"|"+p,i=l.join("::"),jQuery("#"+a,jQuery("#"+a+"plupload-upload-ui").parent()).val(i),plu_show_thumbs(a),jQuery("[data-lity-close]",window.parent.document).trigger("click")}jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery(document).ready(function(a){if(a(".plupload-upload-uic").exists()){var e=!1,i="",l="";if(jQuery("#geodirectory-add-post input[name='ID']").length)l=jQuery("#geodirectory-add-post input[name='ID']").val();else l=jQuery("#post input[name='post_ID']").val();a(".plupload-upload-uic").each(function(){var r=a(this),t=r.attr("id").replace("plupload-upload-ui","");plu_show_thumbs(t),(e=JSON.parse(geodir_plupload_params.base_plupload_config)).browse_button=t+e.browse_button,e.container=t+e.container,jQuery("#"+t+"dropbox").length&&(e.drop_element=t+"dropbox"),e.file_data_name=t+e.file_data_name,e.multipart_params.imgid=t,e.multipart_params.post_id=l,r.hasClass("plupload-upload-uic-multiple")&&(e.multi_selection=!0);var o=jQuery("#"+t+"_allowed_types").val();if(o=o&&""!=o?o:"","post_images"==t&&void 0!==geodir_params.gd_allowed_img_types&&""!=geodir_params.gd_allowed_img_types&&(o=geodir_params.gd_allowed_img_types),o&&""!=o){var d=void 0!==geodir_params.txt_all_files&&""!=geodir_params.txt_all_files?geodir_params.txt_all_files:"Allowed files";e.filters=[{title:d,extensions:o}]}var p,s=new plupload.Uploader(e);s.bind("Init",function(a){}),s.bind("Init",function(a,e){if(s.features.dragdrop){var i=jQuery("#"+(t+"dropbox"));i.on("dragenter",function(a){i.addClass("dragover")}),i.on("dragleave",function(a){i.removeClass("dragover")}),i.on("drop",function(){i.removeClass("dragover")})}}),s.init(),s.bind("Error",function(a,e){if(-600==e.code)jQuery("#"+t+"upload-error").addClass("upload-error"),i=(i=void 0!==geodir_params.err_max_file_size&&""!=geodir_params.err_max_file_size?geodir_params.err_max_file_size:"File size error : You tried to upload a file over %s").replace("%s",geodir_plupload_params.upload_img_size),jQuery("#"+t+"upload-error").html(i);else if(-601==e.code){if(jQuery("#"+t+"upload-error").addClass("upload-error"),i=void 0!==geodir_params.err_file_type&&""!=geodir_params.err_file_type?geodir_params.err_file_type:"File type error. Allowed file types: %s","post_images"==t){var l=""!=o?"."+o.replace(/,/g,", ."):"*";i=i.replace("%s",l)}else i=i.replace("%s",jQuery("#"+t+"_allowed_types").attr("data-exts"));jQuery("#"+t+"upload-error").html(i)}else jQuery("#"+t+"upload-error").addClass("upload-error"),jQuery("#"+t+"upload-error").html(e.message)}),s.bind("FilesAdded",function(e,l){var o=parseInt(jQuery("#"+t+"totImg").val()),d=parseInt(jQuery("#"+t+"image_limit").val());if(jQuery("#"+t+"upload-error").html(""),jQuery("#"+t+"upload-error").removeClass("upload-error"),d&&r.hasClass("plupload-upload-uic-multiple")&&d>0){if(o>=d&&d>0){for(;e.files.length>0;)e.removeFile(e.files[0]);return i=(i=void 0!==geodir_params.err_file_upload_limit&&""!=geodir_params.err_file_upload_limit?geodir_params.err_file_upload_limit:"You have reached your upload limit of %s files.").replace("%s",d),jQuery("#"+t+"upload-error").addClass("upload-error"),jQuery("#"+t+"upload-error").html(i),!1}if(e.files.length>d&&d>0){for(;e.files.length>0;)e.removeFile(e.files[0]);return i=(i=void 0!==geodir_params.err_pkg_upload_limit&&""!=geodir_params.err_pkg_upload_limit?geodir_params.err_pkg_upload_limit:"You may only upload %s files with this package, please try again.").replace("%s",d),jQuery("#"+t+"upload-error").addClass("upload-error"),jQuery("#"+t+"upload-error").html(i),!1}}a.each(l,function(a,e){r.find(".filelist").append('<div class="file" id="'+e.id+'"><b>'+e.name+"</b> (<span>"+plupload.formatSize(0)+"</span>/"+plupload.formatSize(e.size)+') <div class="fileprogress"></div></div>')}),e.refresh(),e.start()}),s.bind("UploadProgress",function(e,i){a("#"+i.id+" .fileprogress").width(i.percent+"%"),a("#"+i.id+" span").html(plupload.formatSize(parseInt(i.size*i.percent/100)))});var u=0,n=new Array;s.bind("FileUploaded",function(e,i,l){var o=parseInt(jQuery("#"+t+"totImg").val());if(n[u]=e,clearInterval(p),p=setTimeout(function(){},1e3),u++,a("#"+i.id).fadeOut(),l=l.response,r.hasClass("plupload-upload-uic-multiple")){o++,jQuery("#"+t+"totImg").val(o);var d=a.trim(a("#"+t,a("#"+t+"plupload-upload-ui").parent()).val());d=d?d+","+l:l,a("#"+t,a("#"+t+"plupload-upload-ui").parent()).val(d)}else a("function geodir_remove_file_index(a){for(var e=0;e<a.length;e++)a[e].files.length>0&&a[e].removeFile(a[e].files[0])}function plu_show_thumbs(a){var e=parseInt(jQuery(\"#\"+a+\"totImg\").val()),i=(parseInt(jQuery(\"#\"+a+\"image_limit\").val()),jQuery),l=i(\"#\"+a+\"plupload-thumbs\");l.html(\"\");var r=i(\"#\"+a,i(\"#\"+a+\"plupload-upload-ui\").parent()).val();if(void 0!==geodir_params.action_remove&&\"\"!=geodir_params.action_remove&&geodir_params.action_remove,r){for(var t=r.split(\"::\"),o=0;o<t.length;o++)if(t[o]&&\"null\"!=t[o]){var d=t[o].split(\"|\"),p=d[0],s=d[1],u=d[2],n=d[3];void 0===s&&(s=\"\"),void 0===u&&(u=\"\"),void 0===n&&(n=\"\");var m=p.substring(t[o].lastIndexOf(\".\")+1);m=m.split(\"?\").shift();var _=p.lastIndexOf(\"/\")+1,f=p.lastIndexOf(\".\");if(f<_)continue;var g=p.substr(_,f<_?loc.length:f),v=\"\",c=\"\";if(\"jpg\"==m||\"jpe\"==m||\"jpeg\"==m||\"png\"==m||\"gif\"==m||\"bmp\"==m||\"ico\"==m)v='<img class=\"gd-file-info\" data-id=\"'+s+'\" data-title=\"'+u+'\" data-caption=\"'+n+'\" data-src=\"'+p+'\" src=\"'+p+'\" alt=\"\"  />';else{var h=\"fa-file\";\"pdf\"==m?h=\"fa-file-pdf\":\"zip\"==m||\"tar\"==m?h=\"fa-file-archive\":\"doc\"==m||\"odt\"==m?h=\"fa-file-word\":\"txt\"==m||\"text\"==m?h=\"fa-file-text\":\"csv\"==m||\"ods\"==m||\"ots\"==m?h=\"fa-file-excel\":\"avi\"!=m&&\"mp4\"!=m&&\"mov\"!=m||(h=\"fa-file-video\"),c=\"file-thumb\",v='<i title=\"'+g+'\" class=\"fa '+h+' gd-file-info\" data-id=\"'+s+'\" data-title=\"'+u+'\" data-caption=\"'+n+'\" data-src=\"'+p+'\" aria-hidden=\"true\"></i>'}var y=i('<div class=\"thumb '+c+'\" id=\"thumb'+a+o+'\">'+v+'<div class=\"gd-thumb-actions\"><span class=\"thumbeditlink\" onclick=\"gd_edit_image_meta('+a+\",\"+o+');\"><i class=\"far fa-edit\" aria-hidden=\"true\"></i></span><span class=\"thumbremovelink\" id=\"thumbremovelink'+a+o+'\"><i class=\"fas fa-trash-alt\" aria-hidden=\"true\"></i></span></div></div>');l.append(y),y.find(\".thumbremovelink\").click(function(){jQuery(\"#\"+a+\"plupload-upload-ui\").hasClass(\"plupload-upload-uic-multiple\")&&(e--,jQuery(\"#\"+a+\"totImg\").val(e)),jQuery(\"#\"+a+\"upload-error\").html(\"\"),jQuery(\"#\"+a+\"upload-error\").removeClass(\"upload-error\");var l=i(this).attr(\"id\").replace(\"thumbremovelink\"+a,\"\");l=parseInt(l);var o=[];r=i(\"#\"+a,i(\"#\"+a+\"plupload-upload-ui\").parent()).val(),t=r.split(\"::\");for(var d=0;d<t.length;d++)d!=l&&(o[o.length]=t[d]);return i(\"#\"+a,i(\"#\"+a+\"plupload-upload-ui\").parent()).val(o.join(\"::\")),plu_show_thumbs(a),!1})}t.length>1&&(l.sortable({update:function(e,r){var t=[];l.find(\".gd-file-info\").each(function(){t[t.length]=i(this).data(\"src\")+\"|\"+i(this).data(\"id\")+\"|\"+i(this).data(\"title\")+\"|\"+i(this).data(\"caption\"),i(\"#\"+a,i(\"#\"+a+\"plupload-upload-ui\").parent()).val(t.join(\"::\")),plu_show_thumbs(a)})}}),l.disableSelection());var b=[];l.find(\".gd-file-info\").each(function(){b[b.length]=i(this).data(\"src\")+\"|\"+i(this).data(\"id\")+\"|\"+i(this).data(\"title\")+\"|\"+i(this).data(\"caption\"),i(\"#\"+a,i(\"#\"+a+\"plupload-upload-ui\").parent()).val(b.join(\"::\"))})}}function gd_edit_image_meta(a,e){var i=jQuery(\"#\"+a.id,jQuery(\"#\"+a.id+\"plupload-upload-ui\").parent()).val().split(\"::\")[e].split(\"|\"),l=i[2],r=i[3],t=\"\";t=(t=(t=t+\"<div class='gd-modal-text'><label for='gd-image-meta-title'>\"+geodir_params.label_title+\"</label><input id='gd-image-meta-title' value='\"+l+\"'></div>\")+\"<div class='gd-modal-text'><label for='gd-image-meta-caption'>\"+geodir_params.label_caption+\"</label><input id='gd-image-meta-caption' value='\"+r+\"'></div>\")+\"<div class='gd-modal-button'><button class='button button-primary button-large' onclick='gd_set_image_meta(\\\"\"+a.id+'\",'+e+\")'>\"+geodir_params.button_set+\"</button></div>\",jQuery(\"#gd-image-meta-input\").html(t),lity(\"#gd-image-meta-input\")}function gd_set_image_meta(a,e){var i=jQuery(\"#\"+a,jQuery(\"#\"+a+\"plupload-upload-ui\").parent()).val(),l=i.split(\"::\"),r=l[e].split(\"|\"),t=r[0],o=r[1],d=jQuery(\"#gd-image-meta-title\").val(),p=jQuery(\"#gd-image-meta-caption\").val();l[e]=t+\"|\"+o+\"|\"+d+\"|\"+p,i=l.join(\"::\"),jQuery(\"#\"+a,jQuery(\"#\"+a+\"plupload-upload-ui\").parent()).val(i),plu_show_thumbs(a),jQuery(\"[data-lity-close]\",window.parent.document).trigger(\"click\")}jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery(document).ready(function(a){if(a(\".plupload-upload-uic\").exists()){var e=!1,i=\"\",l=\"\";if(jQuery(\"#geodirectory-add-post input[name='ID']\").length)l=jQuery(\"#geodirectory-add-post input[name='ID']\").val();else l=jQuery(\"#post input[name='post_ID']\").val();a(\".plupload-upload-uic\").each(function(){var r=a(this),t=r.attr(\"id\").replace(\"plupload-upload-ui\",\"\");plu_show_thumbs(t),(e=JSON.parse(geodir_plupload_params.base_plupload_config)).browse_button=t+e.browse_button,e.container=t+e.container,jQuery(\"#\"+t+\"dropbox\").length&&(e.drop_element=t+\"dropbox\"),e.file_data_name=t+e.file_data_name,e.multipart_params.imgid=t,e.multipart_params.post_id=l,r.hasClass(\"plupload-upload-uic-multiple\")&&(e.multi_selection=!0);var o=jQuery(\"#\"+t+\"_allowed_types\").val();if(o=o&&\"\"!=o?o:\"\",\"post_images\"==t&&void 0!==geodir_params.gd_allowed_img_types&&\"\"!=geodir_params.gd_allowed_img_types&&(o=geodir_params.gd_allowed_img_types),o&&\"\"!=o){var d=void 0!==geodir_params.txt_all_files&&\"\"!=geodir_params.txt_all_files?geodir_params.txt_all_files:\"Allowed files\";e.filters=[{title:d,extensions:o}]}var p,s=new plupload.Uploader(e);s.bind(\"Init\",function(a){}),s.bind(\"Init\",function(a,e){if(s.features.dragdrop){var i=jQuery(\"#\"+(t+\"dropbox\"));i.on(\"dragenter\",function(a){i.addClass(\"dragover\")}),i.on(\"dragleave\",function(a){i.removeClass(\"dragover\")}),i.on(\"drop\",function(){i.removeClass(\"dragover\")})}}),s.init(),s.bind(\"Error\",function(a,e){if(-600==e.code)jQuery(\"#\"+t+\"upload-error\").addClass(\"upload-error\"),i=(i=void 0!==geodir_params.err_max_file_size&&\"\"!=geodir_params.err_max_file_size?geodir_params.err_max_file_size:\"File size error : You tried to upload a file over %s\").replace(\"%s\",geodir_plupload_params.upload_img_size),jQuery(\"#\"+t+\"upload-error\").html(i);else if(-601==e.code){if(jQuery(\"#\"+t+\"upload-error\").addClass(\"upload-error\"),i=void 0!==geodir_params.err_file_type&&\"\"!=geodir_params.err_file_type?geodir_params.err_file_type:\"File type error. Allowed file types: %s\",\"post_images\"==t){var l=\"\"!=o?\".\"+o.replace(/,/g,\", .\"):\"*\";i=i.replace(\"%s\",l)}else i=i.replace(\"%s\",jQuery(\"#\"+t+\"_allowed_types\").attr(\"data-exts\"));jQuery(\"#\"+t+\"upload-error\").html(i)}else jQuery(\"#\"+t+\"upload-error\").addClass(\"upload-error\"),jQuery(\"#\"+t+\"upload-error\").html(e.message)}),s.bind(\"FilesAdded\",function(e,l){var o=parseInt(jQuery(\"#\"+t+\"totImg\").val()),d=parseInt(jQuery(\"#\"+t+\"image_limit\").val());if(jQuery(\"#\"+t+\"upload-error\").html(\"\"),jQuery(\"#\"+t+\"upload-error\").removeClass(\"upload-error\"),d&&r.hasClass(\"plupload-upload-uic-multiple\")&&d>0){if(o>=d&&d>0){for(;e.files.length>0;)e.removeFile(e.files[0]);return i=(i=void 0!==geodir_params.err_file_upload_limit&&\"\"!=geodir_params.err_file_upload_limit?geodir_params.err_file_upload_limit:\"You have reached your upload limit of %s files.\").replace(\"%s\",d),jQuery(\"#\"+t+\"upload-error\").addClass(\"upload-error\"),jQuery(\"#\"+t+\"upload-error\").html(i),!1}if(e.files.length>d&&d>0){for(;e.files.length>0;)e.removeFile(e.files[0]);return i=(i=void 0!==geodir_params.err_pkg_upload_limit&&\"\"!=geodir_params.err_pkg_upload_limit?geodir_params.err_pkg_upload_limit:\"You may only upload %s files with this package, please try again.\").replace(\"%s\",d),jQuery(\"#\"+t+\"upload-error\").addClass(\"upload-error\"),jQuery(\"#\"+t+\"upload-error\").html(i),!1}}a.each(l,function(a,e){r.find(\".filelist\").append('<div class=\"file\" id=\"'+e.id+'\"><b>'+e.name+\"</b> (<span>\"+plupload.formatSize(0)+\"</span>/\"+plupload.formatSize(e.size)+') <div class=\"fileprogress\"></div></div>')}),e.refresh(),e.start()}),s.bind(\"UploadProgress\",function(e,i){a(\"#\"+i.id+\" .fileprogress\").width(i.percent+\"%\"),a(\"#\"+i.id+\" span\").html(plupload.formatSize(parseInt(i.size*i.percent/100)))});var u=0,n=new Array;s.bind(\"FileUploaded\",function(e,i,l){var o=parseInt(jQuery(\"#\"+t+\"totImg\").val());if(n[u]=e,clearInterval(p),p=setTimeout(function(){},1e3),u++,a(\"#\"+i.id).fadeOut(),l=l.response,r.hasClass(\"plupload-upload-uic-multiple\")){o++,jQuery(\"#\"+t+\"totImg\").val(o);var d=a.trim(a(\"#\"+t,a(\"#\"+t+\"plupload-upload-ui\").parent()).val());d=d?d+\",\"+l:l,a(\"#\"+t,a(\"#\"+t+\"plupload-upload-ui\").parent()).val(d)}else a(\"#\"+t,a(\"#\"+t+\"plupload-upload-ui\").parent()).val(l+\"\");plu_show_thumbs(t)})})}});"+t,a("#"+t+"plupload-upload-ui").parent()).val(l+"");plu_show_thumbs(t)})})}});